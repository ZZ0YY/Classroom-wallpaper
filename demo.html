<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>班级壁纸 - (By 风月同天)</title>
    <style>
        /* --- CSS 部分 --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* 引入字体 */
        @font-face { font-family: 'AvenueT'; src: url('resource/AvenueT.ttf') format('truetype'); }
        @font-face { font-family: 'MiSans'; src: url('resource/MiSans-Demibold.ttf') format('truetype'); }
        @font-face { font-family: 'Segment7'; src: url('resource/Segment7Standard.otf') format('opentype'); }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000; /* 黑色底色，用于形成黑边 */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 核心：创建固定16:9的“虚拟屏幕” */
        .viewport-wrapper {
            position: relative;
            width: 100vw; 
            max-width: calc(100vh * (16 / 9));
            height: 100vh;
            max-height: calc(100vw * (9 / 16));
            aspect-ratio: 16 / 9;
            
            background-size: cover;
            background-position: center;
            transition: background-image 0.5s ease-in-out;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        /* 关键：使用Flexbox进行内部布局，替代不稳定的绝对定位 */
        .viewport-content {
            display: flex;
            width: 100%;
            height: 100%;
            padding: 2% 2%; /* 在画框内部留出边距 */
            gap: 2%; /* 栏间距 */
        }

        /* --- 三大栏布局 --- */
        #divleft   { flex-basis: 35%; }
        #divmiddle { flex-basis: 26%; }
        #divright  { flex-basis: 35%; }

        #divleft, #divmiddle, #divright {
            display: flex;
            flex-direction: column;
            min-height: 0; /* Flexbox hack, 允许子元素正确收缩 */
        }
        
        #divmiddle {
            justify-content: center;
            align-items: center;
        }

        /* 元素样式 */
        p, span, b, small, summary {
            color: ghostwhite;
            text-shadow: 0.1vw -0.1vw 0 black, 0.1vw 0.1vw 0 black, -0.1vw -0.1vw 0 black, -0.1vw 0.1vw 0 black;
        }
        .digitalFont { font-family: "Segment7", "MiSans", sans-serif; }
        .normalFont { font-family: "AvenueT", "MiSans", sans-serif; }
        
        /* 关键：使用clamp()进行智能字体缩放 */
        #dutytitle { font-size: clamp(14px, 3.5vw, 40px); margin-top: 2%; }
        #duty { font-size: clamp(12px, 3.2vw, 36px); line-height: 1.4; padding-left: 5%; }
        #clock { font-size: clamp(40px, 15vw, 180px); line-height: 1; }
        #subject { font-size: clamp(20px, 5.5vw, 60px); line-height: 1.1; margin-top: 2%;}

        #announcement-container { width: 100%; overflow: hidden; white-space: nowrap; margin-top: 3%; }
        #announcement { display: inline-block; padding-left: 100%; font-size: clamp(10px, 1.6vw, 20px); animation: marquee-scroll 30s linear infinite; }
        @keyframes marquee-scroll { from { transform: translateX(0); } to { transform: translateX(-100%); } }

        #countdown-wrapper { margin-top: 5%; }
        #countDown p, #countUp p { font-size: clamp(16px, 4vw, 45px); line-height: 1.2; }
        .countDownLarge { font-size: clamp(18px, 5vw, 55px); }

        /* 关键修正：确保右侧课表永不相互挤压 */
        #divright {
            justify-content: space-around; /* 均匀分布垂直空间 */
        }
        #today-schedule-wrapper, #tomorrow-schedule-wrapper {
            width: 100%;
            display: flex;
            flex-direction: column;
            min-height: 0; /* 允许收缩 */
            flex-basis: 48%; /* 大致各占一半空间 */
        }
        #scheduletitle, #tomorrow-scheduletitle {
            font-size: clamp(14px, 3vw, 36px);
            font-weight: 500;
            text-align: right;
            margin-bottom: 2%;
            flex-shrink: 0; /* 标题不收缩 */
        }
        #tomorrow-scheduletitle { color: #ccc; }
        details { display: contents; } /* 让details标签不影响flex布局 */
        summary { list-style: none; cursor: pointer; }
        
        #schedule, #tomorrow-schedule {
            font-size: clamp(12px, 2.8vw, 32px);
            line-height: 1.3;
            text-align: right;
            overflow-y: auto; /* 关键：内容过长时出现滚动条 */
            flex-grow: 1; /* 占据剩余空间 */
        }
        /* 美化滚动条 */
        #schedule::-webkit-scrollbar, #tomorrow-schedule::-webkit-scrollbar { width: 5px; }
        #schedule::-webkit-scrollbar-thumb, #tomorrow-schedule::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 5px; }
        
        #tomorrow-schedule .scheduleItem span { color: #b0c4de; }
        .scheduleSeparator { height: 1.5vh; }
        .scheduleItem { display: flex; align-items: center; justify-content: flex-end; gap: 1vw; }
        .emoji { width: clamp(12px, 2.8vw, 32px); height: auto; }
        #currentClass { color: #ffdd57; transform: scale(1.05); }
    </style>
</head>
<body onload="setRandomBackground()">

    <div class="viewport-wrapper">
        <div class="viewport-content">
            <div id="divleft">
                <p class="normalFont" id="dutytitle">值日生:</p>
                <p class="normalFont" id="duty"></p>
            </div>
            <div id="divmiddle">
                <p class="digitalFont" id="clock"></p>
                <p class="digitalFont" id="subject"></p>
                <div id="announcement-container">
                    <p class="normalFont" id="announcement"></p>
                </div>
                <div id="countdown-wrapper">
                    <p class="digitalFont" id="countDown"></p>
                    <p class="digitalFont" id="countUp"></p>
                </div>
            </div>
            <div id="divright">
                <div id="today-schedule-wrapper">
                    <p class="normalFont" id="scheduletitle">今日课表</p>
                    <div class="normalFont" id="schedule"></div>
                </div>
                <details id="tomorrow-schedule-wrapper" open>
                    <summary class="normalFont" id="tomorrow-scheduletitle">明日课表</summary>
                    <div class="normalFont" id="tomorrow-schedule"></div>
                </details>
            </div>
        </div>
    </div>
    
    <script type="text/javascript">
    // ========================================================================
    // ===                 CONFIG.JS CONTENT START                        ===
    // ========================================================================
    var revWeek = true;
    var temporaryDayOfWeek = null;
    var announcementList = [ "欢迎使用班级壁纸Demo", "祝您有愉快的一天" ];
    var announcementRandomOrder = true;
    var countdownList = [ ["高考", "2026/06/07"], ["元旦", "2025/01/01"] ];
    var countdownShowPastDate = false;
    var countdownAnimation = false;
    var dutyListConsistent = true;
    var dutyList = [ [ "今日无值日", "扫地: 小明<br />黑板: 小红<br />讲台: 小刚", "扫地: 李华<br />黑板: 张伟<br />讲台: 王芳", "扫地: 小明<br />黑板: 小红<br />讲台: 小刚", "扫地: 李华<br />黑板: 张伟<br />讲台: 王芳", "扫地: 小明<br />黑板: 小红<br />讲台: 小刚", "今日无值日" ], [] ];
    var emojiEnabled = true;
    var emojiFilename = [ 'drooling-face_1.png', 'exploding-head.png', 'loudly-crying-face.png', 'smiling-face-with-hearts.png', 'sad-but-relieved-face.png', 'tired-face.png', 'pleading-face.png', 'cold-face.png', 'hot-face.png', 'alien.png', 'clown-face.png', 'sleepy-face.png', 'face-without-mouth.png', 'skull-and-crossbones.png', 'dotted-line-face.png', 'confounded-face.png' ];
    var subjectListConsistent = true;
    var subjectList = [ [ [], [[740, "外语"], [830, "化学"], [920, "语文"], [1020, "数学"], [1120, "物理"], null, [1430, "班会"], [1540, "地理"], [1630, "集体备课"], [1720, "晚自习"]], [[740, "外语"], [830, "外语"], [920, "地理"], [1020, "数学"], [1120, "体育"], null, [1430, "语文"], [1540, "化学"], [1630, "物理"]], [[740, "语文"], [830, "语文"], [920, "外语"], [1020, "外语"], [1120, "化学"], null, [1430, "数学"], [1540, "地理"], [1630, "物理"]], [[740, "数学"], [830, "体育"], [920, "语文"], [1020, "外语"], [1120, "外语"], null, [1430, "物理"], [1540, "地理"], [1630, "化学"]], [[740, "语文"], [830, "地理"], [920, "化学"], [1020, "数学"], [1120, "数学"], null, [1430, "物理"], [1540, "物理"], [1630, "外语"]], [] ], [] ];
    var defaultClassDuration = 40;
    var promptAfterSchool = "请今日值日生做好值日工作";
    var promptEmptySchedule = "今日无课";
    var showTimeSeconds = true;
    var updateInterval = 500;
    var promptUpdateDelay = 2;
    // ========================================================================
    // ===                  CONFIG.JS CONTENT END                         ===
    // ========================================================================


    // ========================================================================
    // ===                 CORE.JS CONTENT START                          ===
    // ========================================================================
    function prefixZero(num, n){ return (Array(n).join(0) + num).slice(-n); }
    function getWeekParity(date = new Date()){ var d = date; var f = new Date(d.getFullYear(), 0, 1); var w = Math.ceil((parseInt((d - f) / (24 * 60 * 60 * 1000)) + 1 + f.getDay()) / 7); return revWeek ? w % 2 : (w + 1) % 2; }
    function getDay(d){ return (temporaryDayOfWeek === null) ? d.getDay() : temporaryDayOfWeek; }
    function updateTime(){ var d = new Date(); if (d.getMinutes() != window.MINUTE) { window.MINUTE = d.getMinutes(); updateSubject(d); } document.getElementById("clock").innerHTML = "<b>" + prefixZero(d.getHours(), 2) + ":" + prefixZero(d.getMinutes(), 2) + (showTimeSeconds ? ("<small><small>:"+ prefixZero(d.getSeconds(), 2) + "</small></small></b>"): "</b>"); }
    function updateSubject(d){ const subjectsToday = subjectList[getWeekParity()][getDay(d)]; const now = d.valueOf(); if (!subjectsToday || subjectsToday.length === 0) { document.getElementById("subject").innerHTML = promptEmptySchedule; return; } let currentClassIndex = -1, nextClassIndex = -1; for (let i = subjectsToday.length - 1; i >= 0; i--) { const subject = subjectsToday[i]; if (subject === null) continue; const classStartTime = new Date(d); classStartTime.setHours(parseInt(subject[0] / 100), subject[0] % 100, 0, 0); if (now >= classStartTime.valueOf()) { currentClassIndex = i; break; } } for (let i = 0; i < subjectsToday.length; i++) { const subject = subjectsToday[i]; if (subject === null) continue; const classStartTime = new Date(d); classStartTime.setHours(parseInt(subject[0] / 100), subject[0] % 100, 0, 0); if (classStartTime.valueOf() > now + promptUpdateDelay * 60 * 1000) { nextClassIndex = i; break; } } let lastClass = null, lastClassIndex = -1; for(let i = subjectsToday.length - 1; i >= 0; i--) { if(subjectsToday[i] !== null) { lastClass = subjectsToday[i]; lastClassIndex = i; break; } } if (lastClass !== null) { const lastClassEndTime = new Date(d); lastClassEndTime.setHours(parseInt(lastClass[0] / 100), lastClass[0] % 100, 0, 0); const duration = lastClass[2] ? lastClass[2] : defaultClassDuration; lastClassEndTime.setMinutes(lastClassEndTime.getMinutes() + duration); if (now >= lastClassEndTime.valueOf()) { document.getElementById("subject").innerHTML = promptAfterSchool; updateSchedule(lastClassIndex); return; } } if (nextClassIndex !== -1) { const nextSubject = subjectsToday[nextClassIndex]; document.getElementById("subject").innerHTML = "下一节 " + nextSubject[1] + " <b>" + prefixZero(parseInt(nextSubject[0] / 100), 2) + ":" + prefixZero(nextSubject[0] % 100, 2) + "</b>"; } else { document.getElementById("subject").innerHTML = promptAfterSchool; } updateSchedule(currentClassIndex); }
    function updateSchedule(currentClass){ var items = document.getElementById('schedule').children; if(window.CLASS !== currentClass){ window.CLASS = currentClass; var classIndexCounter = -1; for(let element of items){ if(element.className.includes('scheduleItem')){ classIndexCounter++; element.id = (classIndexCounter === currentClass) ? 'currentClass' : ''; } } } }
    function initTomorrowSchedule() { const tomorrowDate = new Date(); tomorrowDate.setDate(tomorrowDate.getDate() + 1); const subjectsTomorrow = subjectList[getWeekParity(tomorrowDate)][tomorrowDate.getDay()]; const container = document.getElementById("tomorrow-schedule"); container.innerHTML = ""; if (!subjectsTomorrow || subjectsTomorrow.length === 0) { container.innerHTML = "<div class='scheduleItem'><span>明天没有课哦</span></div>"; return; } let scheduleHTML = ""; subjectsTomorrow.forEach(element => { scheduleHTML += (element === null) ? "<div class='scheduleSeparator'></div>" : `<div class='scheduleItem'><span>${element[1]}</span></div>`; }); container.innerHTML = scheduleHTML; }
    function init(){ var d = new Date(); window.DATE = d.getDate(); window.MINUTE = d.getMinutes(); window.CLASS = -1; document.getElementById("schedule").innerHTML = ""; document.getElementById("tomorrow-schedule").innerHTML = ""; if(subjectListConsistent){ subjectList[1] = subjectList[0]; } let emojiFilenameCopy = JSON.parse(JSON.stringify(emojiFilename)); let todayScheduleHTML = ""; subjectList[getWeekParity(d)][getDay(d)].forEach((element) => { if(element === null){ todayScheduleHTML += "<div class='scheduleSeparator'></div>"; } else { let emoji = emojiFilenameCopy.splice(Math.floor(Math.random() * emojiFilenameCopy.length), 1)[0] || emojiFilename[0]; let classDiv = (emojiEnabled) ? `<div class='scheduleItem'><img class='emoji' src='emoji/${emoji}' /><span>${element[1]}</span></div>` : `<div class='scheduleItem'><span></span><span>${element[1]}</span></div>`; if(emojiEnabled && !emojiFilenameCopy.length){ emojiFilenameCopy = JSON.parse(JSON.stringify(emojiFilename)); } todayScheduleHTML += classDiv; } }); document.getElementById("schedule").innerHTML = todayScheduleHTML; initTomorrowSchedule(); if(dutyListConsistent){ dutyList[1] = dutyList[0]; } document.getElementById("duty").innerHTML = dutyList[getWeekParity(d)][getDay(d)]; if(announcementRandomOrder){ announcementList.sort(() => Math.random() - 0.5); } const announcementEl = document.getElementById("announcement"); if (announcementEl) { announcementEl.innerHTML = announcementList.join(" &nbsp; • &nbsp; "); const textWidth = announcementEl.offsetWidth; const containerWidth = document.getElementById("announcement-container").offsetWidth; const duration = (textWidth + containerWidth) / 100; announcementEl.style.animationDuration = Math.max(duration, 15) + 's'; } document.getElementById("countDown").innerHTML = ""; document.getElementById("countUp").innerHTML = ""; countdownList.forEach((element, index) => { if (!element || element.length === 0) return; var interval = Date.parse(element[1]) - d; if(interval > 0){ generateCountDown(index, element[0], Math.ceil(interval / 86400000)); }else if(countdownShowPastDate){ generateCountUp(index, element[0], Math.floor(Math.abs(interval / 86400000))); } }); updateTime(); updateSubject(d); }
    function generateCountDown(index, name, days){ document.getElementById("countDown").innerHTML += `<p>距离<span class='countDownLarge'>${name}</span>还有<span class='countDownLarge'><b>${prefixZero(days, 3)}</b></span>天</p>`; }
    function generateCountUp(index, name, days){ document.getElementById("countUp").innerHTML = `<p><span class='countDownLarge'>${name}</span>结束已经<span class='countDownLarge'><b>${prefixZero(days, 3)}</b></span>天</p>` + document.getElementById("countUp").innerHTML; }
    document.addEventListener("DOMContentLoaded", function() { init(); window.setInterval(updateTime, updateInterval); });
    // ========================================================================
    // ===                  CORE.JS CONTENT END                           ===
    // ========================================================================
    
    // --- 随机背景图JS ---
    function setRandomBackground() {
        var images = [
            'resource/image1.jpg', 'resource/image2.jpg', 'resource/image3.jpg', 
            'resource/image4.jpg', 'resource/9月30日.png'
        ];
        var randomIndex = Math.floor(Math.random() * images.length);
        var wrapper = document.querySelector('.viewport-wrapper');
        if (wrapper) {
            wrapper.style.backgroundImage = 'url(' + images[randomIndex] + ')';
        }
    }
    </script>
</body>
</html>